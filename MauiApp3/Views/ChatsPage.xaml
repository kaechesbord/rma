<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MauiApp3.ViewModels"
             x:Class="MauiApp3.Views.ChatsPage"
             BackgroundColor="White">


    <Grid RowDefinitions="Auto, Auto, *, Auto">

        <Grid Grid.Row="0" ColumnDefinitions="Auto, *, Auto" Padding="15, 10">
            <Button Text="Edit" TextColor="#007AFF" BackgroundColor="Transparent" Margin="35,0,0,0" HorizontalOptions="Start"/>
            <Label Grid.Column="1" Text="Chats" FontSize="18" FontAttributes="Bold" Margin="25,0,0,0" HorizontalOptions="Center" VerticalOptions="Center"/>
            <ImageButton Grid.Column="2" Source="edit_icon.svg" HeightRequest="25" HorizontalOptions="End"/>
        </Grid>

        <Grid Grid.Row="1" ColumnDefinitions="*, *" Padding="15, 5">
            <Label Text="Broadcast Lists" TextColor="#007AFF" HorizontalOptions="Start"/>
            <Label Grid.Column="1" Text="New Group" TextColor="#007AFF" HorizontalOptions="End"/>
        </Grid>

        <CollectionView Grid.Row="2" ItemsSource="{Binding Chats}"  
                SelectionMode="Single"
                SelectionChanged="OnChatSelected" Margin="0,10,0,0">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems Mode="Reveal">
                                <SwipeItem Text="More" BackgroundColor="#C8C7CD"/>
                                <SwipeItem Text="Archive" BackgroundColor="#3E70A7"/>
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <Grid Padding="15, 10" ColumnDefinitions="60, *, Auto" RowDefinitions="Auto, Auto">
                            <Frame Grid.Column="0" Grid.RowSpan="2" CornerRadius="30" HeightRequest="60" WidthRequest="60" 
                                   Padding="0" IsClippedToBounds="True" BorderColor="Transparent" VerticalOptions="Center">
                                <Image Source="{Binding AvatarUrl}" Aspect="AspectFill"/>
                            </Frame>

                            <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Padding="15,0">
                                <Label Text="{Binding Name}" FontAttributes="Bold" FontSize="16" TextColor="Black"/>
                                <HorizontalStackLayout Spacing="5">
                                    <Label Text="✓✓" TextColor="#007AFF" IsVisible="{Binding IsRead}"/>
                                    <Label Text="{Binding LastMessage}" TextColor="Gray" MaxLines="1" LineBreakMode="TailTruncation"/>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>

                            <HorizontalStackLayout Grid.Column="2" VerticalOptions="Start" Spacing="5">
                                <Label Text="{Binding Time}" TextColor="Gray" FontSize="13"/>
                                <Label Text="›" TextColor="#C7C7CC" FontSize="20" VerticalOptions="Center"/>
                            </HorizontalStackLayout>

                            <BoxView Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" HeightRequest="0.5" 
                                     BackgroundColor="#C7C7CC" VerticalOptions="End" Margin="15,10,0,0"/>
                        </Grid>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>